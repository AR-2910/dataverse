<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=<YOUR CODE>"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date()); gtag('config', '<YOUR CODE>');
</script>

<!-- This script adds events to google analytics, leveraging the btn-* css classes -->
<script>
 
// MOVED TO dv_rebind_bootstrap_ui.js for primefaces+ajax+bootstrap+jquery work around
 //  $(document).ready(function() {
    // buttonEvents();
 //  });

  function buttonEvents() {

    // Download button
    $('.btn-download').click(function() {
      var category = $(this).text();
      var label = getFileId($(this));
      gtag('event', 'Download',{'event_category' : category,
                                'event_label' : label});

      // DEBUGGER FOR DEV ONLY
      console.log('EVENT : Download : ' + category + ' : ' + label);
    });

    // Request Access button
    $('.btn-request').click(function() {
      var category = $(this).text();
      var label = getFileId($(this));
      gtag('event', 'Request Access', {'event_category' : category,
                                       'event_label' : label});

      // DEBUGGER FOR DEV ONLY
      console.log('EVENT : Request Access : ' + category + ' : ' + label);
    });

    // Explore button
    $('.btn-explore').click(function() {
      var category = $(this).text();
      var label = getFileId($(this));
      gtag('event', 'Explore', {'event_category' : category,
                                'event_label' : label});

      // DEBUGGER FOR DEV ONLY
      console.log('EVENT : Explore : ' + category + ' : ' + label);
    });

    // Compute button
    $('.btn-compute').click(function() {
      var category = $(this).text();
      var label = getFileId($(this));
      gtag('event', 'Compute', {'event_category' : category,
                                'event_label' : label});

      // DEBUGGER FOR DEV ONLY
      console.log('EVENT : Compute : ' + category + ' : ' + label);
    });

    // Preview button
    $('.btn-preview').click(function() {
      var category = $(this).text();
      var label = getFileId($(this));
      gtag('event', 'Preview', {'event_category' : category,
                                'event_label' : label});

      // DEBUGGER FOR DEV ONLY
      console.log('EVENT : Preview : ' + category + ' : ' + label);
    });

    // Cite button
    $('.downloadCitation + ul.dropdown-menu li a').click(function() {
      var category = $(this).text();
      var label = 'Unknown';
      if($('#fileForm').length > 0) {
        label = stripId($('#fileForm').attr('action'));
      } else if($('#datasetForm').length > 0) {
        label = stripId($('#datasetForm').attr('action'));
      }
      gtag('event', 'Download Citation', {'event_category' : category,
                                        'event_label' : label});

      // DEBUGGER FOR DEV ONLY
      console.log('EVENT : Download Citation : ' + category + ' : ' + label);
    });

    // Export Metadata button
    $('.btn-export + ul.dropdown-menu li a').click(function() {
      var category = $(this).text();
      var label = 'Unknown';
      if($('#fileForm').length > 0) {
        label = stripId($('#fileForm').attr('action'));
      } else if($('#datasetForm').length > 0) {
        label = stripId($('#datasetForm').attr('action'));
      }
      gtag('event', 'Export Metadata', {'event_category' : category,
                                        'event_label' : label});

      // DEBUGGER FOR DEV ONLY
      console.log('EVENT : Export Metadata : ' + category + ' : ' + label);
    });

    // Contact button 
    $('.btn-contact').click(function() {
      var category = $(this).text();
      var label = 'Unknown';
      if($('#fileForm').length > 0) {
        label = stripId($('#fileForm').attr('action'));
      } else if($('#datasetForm').length > 0) {
        label = stripId($('#datasetForm').attr('action'));
      } else if($('#dataverseForm').length > 0) {
        label = stripAlias($('#dataverseForm').attr('action'));
      }
      gtag('event', 'Contact', {'event_category' : category,
                                'event_label' : label});

      // DEBUGGER FOR DEV ONLY
      console.log('EVENT : Contact : ' + category + ' : ' + label);
    });

    // Share button
    $('div[id$="shareDialog"] a[class^="sharrre"]').click(function() {
      var sharrreVal = $(this).attr('class');
      var category = sharrreVal.substring(sharrreVal.indexOf('-') + 1) ;
      var label = 'Unknown';
      if($('#fileForm').length > 0) {
        label = stripId($('#fileForm').attr('action'));
      } else if($('#datasetForm').length > 0) {
        label = stripId($('#datasetForm').attr('action'));
      } else if($('#dataverseForm').length > 0) {
        label = stripAlias($('#dataverseForm').attr('action'));
      }
      gtag('event', 'Share', {'event_category' : category,
                              'event_label' : label});

      // DEBUGGER FOR DEV ONLY
      console.log('EVENT : Share : ' + category + ' : ' + label);
    });

  }

  function getFileId(target) {
    var label = 'Unknown';
    var row = target.parents('tr')[0];
    if(row != null) {
      label = $(row).find('td.col-file-metadata > a').attr('href');
    } else {
      label = $('#fileForm').attr('action');
    }
    label = stripId(label);
    return label;
  }

  function stripId(label) {
    var index = label.indexOf('&');
    if(index == -1) index = label.length;
    if(label.indexOf('persistentId=') >= 0) {
      label = label.substring(label.indexOf('persistentId=') + 13, index);
    }
    if(label.indexOf('fileId=') >= 0) {
      label = label.substring(label.indexOf('fileId=') + 7, index);
    }
    return(label);
  }

  function stripAlias(label) {
    var index = label.length;
    label = label.substring(label.indexOf('/dataverse/') + 11, index).split(/[?#]/)[0];
    return(label);
  }
</script>
